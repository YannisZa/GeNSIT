log_level = 'info'
sweep_mode = true

[inputs]
n_workers = +1
n_threads = [+6,+6]
device = 'cpu'
to_learn = ['alpha', 'beta']
in_directory = './data/inputs/'
dataset = 'cambridge_work_commuter_lsoas_to_msoas'
load_experiment = ''
[inputs.seed.sweep]
  default = "1:10000:1"
  range = [
    "1:10000:1","1:10000:1","1:10000:1",
    "1:1000:1","1:1000:1","1:1000:1",
    "1:100:1","1:100:1","1:100:1",
    "1:10:1","1:10:1","1:10:1",
    "1:1:1","1:1:1","1:1:1"
  ]

[inputs.data]
    [inputs.data.origin_demand]
      file = 'origin_demand_sum_normalised.txt'
    [inputs.data.destination_attraction_ts]
      file ='destination_attraction_time_series_sum_normalised.txt'
    [inputs.data.cost_matrix]
      file = """cost_matrices/clustered_facilities_sample_20x20_20_01_2023_\
      sample_20x20_clustered_facilities_ripleys_k_500_euclidean_points%_\
      prob_origin_destination_adjusted_normalised_boundary_only_\
      edge_corrected_cost_matrix_max_normalised.txt"""
    [inputs.data.table]
      file = 'table_lsoas_to_msoas.txt'

[contingency_table]
  sparse_margins = false
  [contingency_table.constraints.axes.sweep]
    default = []
    range = [[], [[+0,+1]], [[+1]], [[+0],[+1]], [[+0],[+1]], [[+0],[+1]]]
  [contingency_table.constraints.cells.sweep]
    default = ''
    range = ['','','','',
      'cell_constraints_permuted_size_90_cell_percentage_10_constrained_axes_0_1_seed_1234.txt',
      'cell_constraints_permuted_size_179_cell_percentage_20_constrained_axes_0_1_seed_1234.txt'
    ]
    coupled = true
    target_name = 'axes'

[spatial_interaction_model]
  # name = 'ProductionConstrained','TotallyConstrained'
  name = 'TotallyConstrained'
  grand_total = +33704
  [spatial_interaction_model.parameters]
    bmax = +1.0
    alpha = +1.0
    beta = +1.0
  
[harris_wilson_model]
  dt = +0.001
  [harris_wilson_model.parameters]
    epsilon = 1.0
    [harris_wilson_model.parameters.sigma.sweep]
      default = 0.0141421356
      range = [0.0141421356, 0.1414213562, nan]

[training]
  num_steps = +1
  batch_size = +1
  [training.N.sweep]
    default = "repeat(1,1)"
    range = [
      "repeat(10,10000)","repeat(10,10000)","repeat(10,10000)",
      "repeat(10,1000)","repeat(10,1000)","repeat(10,1000)",
      "repeat(10,100)","repeat(10,100)","repeat(10,100)",
      "repeat(10,10)","repeat(10,10)","repeat(10,10)",
      "repeat(1,1)","repeat(1,1)","repeat(1,1)"
    ]
    coupled = true
    target_name = 'seed'

[mcmc]
    disable_tqdm = true
    mcmc_workers = +1
    
    [mcmc.contingency_table]
      table_steps = +1
      proposal = 'direct_sampling'
      table0 = 'maximum_entropy_solution'
      margin0 = 'multinomial'

[neural_network]
  disable_tqdm = true
  [neural_network.loss_function] 
    loss_name = 'mseloss'
  [neural_network.hyperparameters]
    num_layers = +1
    optimizer = 'Adam'
    learning_rate = +0.002
    [neural_network.hyperparameters.biases]
      default = [+0.0, +4.0]
      [neural_network.hyperparameters.biases.layer_specific]
    [neural_network.hyperparameters.nodes_per_layer]
      default = +20
      [neural_network.hyperparameters.nodes_per_layer.layer_specific]
    [neural_network.hyperparameters.activation_funcs]
      default = 'linear'
      [neural_network.hyperparameters.activation_funcs.layer_specific]
        1 = 'abs'

[[experiments]]
  type = 'NonJointTableSIM_NN'
  comment = 'Non-independent Joint Table and Spatial Interaction Model parameter learning using Neural Networks'
  disable_tqdm = true
  print_statements = true
  export_samples = true
  export_metadata = true
  overwrite = true


[[experiments]]
  type = 'JointTableSIM_NN'
  comment = 'dependent Joint Table and Spatial Interaction Model parameter learning using Neural Networks'
  disable_tqdm = true
  print_statements = true
  export_samples = true
  export_metadata = true
  overwrite = true


[outputs]
    write_start = +1
    write_every = +1
    out_directory = './data/outputs/'
    [outputs.experiment_title.sweep]
      default = '_uncostrained'
      range = ['_uncostrained','_total_constrained','_row_constrained','_doubly_constrained','_doubly_10%_cell_constrained','_doubly_20%_cell_constrained']
      coupled = true
      target_name = 'axes'